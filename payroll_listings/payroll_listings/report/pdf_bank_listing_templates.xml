<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_bank_listing_pdf_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="payroll_listings.report_bank_listing_pdf_content" t-lang="doc.env.user.lang"/>
            </t>
        </t>
    </template>

    <template id="report_bank_listing_pdf_content">
        <div class="page">
                <h3 class="text-center"><span t-esc="report_type_label or 'Bank Listing Report'"/></h3>
                <br/>

                <t t-if="data_by_bank">
                    <t t-set="grand_total" t-value="0.0"/>
                    
                    <t t-foreach="data_by_bank.items()" t-as="bank_item">
                    <t t-set="bank_name" t-value="bank_item[0]"/>
                    <t t-set="bank_data" t-value="bank_item[1]"/>
                    
                    <!-- Bank Header -->
                    <div class="text-center mt-4 mb-3" style="background-color: #f8f9fa; padding: 15px; border: 2px solid #dee2e6; font-weight: bold; font-size: 18px;">
                        <t t-esc="bank_name.upper()"/>
                    </div>
                    
                    <!-- Table for this bank only -->
                    <table class="table table-sm table-striped table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>Nom et Prénom</th>
                                <th>Matricule</th>
                                <th>Numéro de Compte</th>
                                <th class="text-end">Net à Payer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="bank_total" t-value="0.0"/>
                            <t t-foreach="bank_data.get('records', [])" t-as="row">
                                <tr>
                                    <td><span t-esc="row.get('employee_name') or ''"/></td>
                                    <td><span t-esc="row.get('employee_matricule') or ''"/></td>
                                    <td><span t-esc="row.get('bank_account') or ''"/></td>
                                    <td class="text-end">
                                        <t t-set="net_wage" t-value="row.get('net_wage', 0.0)"/>
                                        <span t-esc="net_wage" t-options='{"widget": "float", "precision": 2}'/>
                                        <t t-set="bank_total" t-value="bank_total + net_wage"/>
                                        <t t-set="grand_total" t-value="grand_total + net_wage"/>
                                    </td>
                                </tr>
                            </t>
                            <!-- Bank subtotal -->
                            <tr class="table-warning">
                                <td colspan="3" class="text-end"><strong>Sous-total</strong></td>
                                <td class="text-end">
                                    <strong><span t-esc="bank_total" t-options='{"widget": "float", "precision": 2}'/></strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- Add space between banks -->
                    <div style="height: 20px;"></div>
                </t>
                
                <!-- Grand Total at the end -->
                <table class="table table-sm table-bordered mt-4">
                    <thead class="table-primary">
                        <tr>
                            <th colspan="3" class="text-end"><strong>TOTAL GÉNÉRAL</strong></th>
                            <th class="text-end">
                                <strong><span t-esc="grand_total" t-options='{"widget": "float", "precision": 2}'/></strong>
                            </th>
                        </tr>
                    </thead>
                </table>
                </t>
                <t t-else="">
                    <p class="text-center">Aucune donnée disponible pour ce rapport.</p>
                </t>
            </div>
    </template>
</odoo>