<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- Caisse Security Categories -->
        <record id="module_category_caisse" model="ir.module.category">
            <field name="name">Caisse Management</field>
            <field name="description">Manage caisse access rights</field>
            <field name="sequence">20</field>
        </record>

        <!-- Security Groups -->

        <!-- Caisse Employee: Can create and view own requests -->
        <record id="group_caisse_employee" model="res.groups">
            <field name="name">Caisse Employee</field>
            <field name="category_id" ref="module_category_caisse"/>
            <field name="comment">Can create fund requests and view own requests</field>
        </record>

        <!-- Caisse Manager: Can approve requests -->
        <record id="group_caisse_manager" model="res.groups">
            <field name="name">Caisse Manager</field>
            <field name="category_id" ref="module_category_caisse"/>
            <field name="implied_ids" eval="[(4, ref('group_caisse_employee'))]"/>
            <field name="comment">Can approve/reject fund requests</field>
        </record>

        <!-- Caisse Cashier: Can disburse funds -->
        <record id="group_caisse_cashier" model="res.groups">
            <field name="name">Caisse Cashier</field>
            <field name="category_id" ref="module_category_caisse"/>
            <field name="implied_ids" eval="[(4, ref('group_caisse_employee'))]"/>
            <field name="comment">Can disburse approved requests and manage cash</field>
        </record>

        <!-- Caisse Administrator: Full access to configuration -->
        <record id="group_caisse_admin" model="res.groups">
            <field name="name">Caisse Administrator</field>
            <field name="category_id" ref="module_category_caisse"/>
            <field name="implied_ids" eval="[(4, ref('group_caisse_manager')), (4, ref('group_caisse_cashier'))]"/>
            <field name="comment">Full access to caisse configuration and all operations</field>
        </record>

        <!-- Record Rules -->

        <!-- Caisse Request Rules -->
        <record id="caisse_request_admin_rule" model="ir.rule">
            <field name="name">Caisse Request: Admin Access</field>
            <field name="model_id" ref="model_caisse_request"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_caisse_admin'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="caisse_request_superuser_rule" model="ir.rule">
            <field name="name">Caisse Request: Superuser Access</field>
            <field name="model_id" ref="model_caisse_request"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="caisse_request_employee_rule" model="ir.rule">
            <field name="name">Caisse Request: Employee Access</field>
            <field name="model_id" ref="model_caisse_request"/>
            <field name="domain_force">['|', ('employee_id.user_id', '=', user.id), ('employee_id.user_id', '=', False)]</field>
            <field name="groups" eval="[(4, ref('group_caisse_employee'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="caisse_request_manager_rule" model="ir.rule">
            <field name="name">Caisse Request: Manager Access</field>
            <field name="model_id" ref="model_caisse_request"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_caisse_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="caisse_request_cashier_rule" model="ir.rule">
            <field name="name">Caisse Request: Cashier Access</field>
            <field name="model_id" ref="model_caisse_request"/>
            <field name="domain_force">[('state', 'in', ['manager_approved', 'disbursed', 'settled'])]</field>
            <field name="groups" eval="[(4, ref('group_caisse_cashier'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Caisse Disbursement Rules -->
        <record id="caisse_disbursement_cashier_rule" model="ir.rule">
            <field name="name">Caisse Disbursement: Cashier Access</field>
            <field name="model_id" ref="model_caisse_disbursement"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_caisse_cashier'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="caisse_disbursement_manager_rule" model="ir.rule">
            <field name="name">Caisse Disbursement: Manager Access</field>
            <field name="model_id" ref="model_caisse_disbursement"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_caisse_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Caisse Reconciliation Rules -->
        <record id="caisse_reconciliation_cashier_rule" model="ir.rule">
            <field name="name">Caisse Reconciliation: Cashier Access</field>
            <field name="model_id" ref="model_caisse_reconciliation"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_caisse_cashier'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="caisse_reconciliation_manager_rule" model="ir.rule">
            <field name="name">Caisse Reconciliation: Manager Access</field>
            <field name="model_id" ref="model_caisse_reconciliation"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_caisse_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Caisse Configuration Rules -->
        <record id="caisse_config_admin_rule" model="ir.rule">
            <field name="name">Caisse Config: Admin Access</field>
            <field name="model_id" ref="model_caisse_config"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_caisse_admin'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- User assignment to groups (for demo/testing) -->
        <record id="base.user_admin" model="res.users">
            <field name="groups_id" eval="[(4, ref('group_caisse_admin'))]"/>
        </record>

    </data>
</odoo>